require "base"
require "number"
require "string"
require "console"
require "array"



type vector(T) = {
  data array(T),
  size num
}


vector() =
  vector(makeUninitializedArray(0), 0)

push(vec, x) = {
  // Check if we have enough space for the new element and reallocate array with
  // doubled capacity if current space is not sufficient
  capacity = length(vec#data)
  if vec#size == capacity then
  {
    newcapacity = if capacity == 0 then 1 else capacity*2
    set vec#data = copyArray(vec#data, 0, newcapacity)
  }
  
  // Append new element and increment vector size
  set vec#data[vec#size] = x
  set vec#size = vec#size + 1
}

require "error"

vec[k] =
  if k >= vec#size then
    error("vector index out of range:", k, vec)
  else
    vec#data[k]

set vec[k] = x =
  if k >= vec#size then
    error("vector index out of range:", k, vec)
  else
    set vec#data[k] = x

forEach(vec, f) =
  loop(0)
  where loop(i) =
    if i < vec#size then {
      f(vec[i])
      loop(i + 1)
    } else []


type vectorIterator(T) = {
  data array(T),
  max num,
  cur num
}

iter(vec, from) = vectorIterator(vec#data, vec#size, from)
iter(vec) = vectorIterator(vec#data, vec#size, 0)

next(it) = {
  if false then set it = vectorIterator(it#data, it#max, it#cur)
  if it#cur < it#max then {
    result = it#data[it#cur]
    set it#cur = it#cur + 1
    Some(result)
  }
  else
    Nothing()
}

vec = vector()
vec.push(1)
vec.push(2)
vec.push(3)

require "itertools"

println("vector:")
it = vec.iter()
println("it =", it)
println("next(it) =", next(it))
it.forEach(x => println("-", x))

// println("vector data:")
// vec#data.iter().forEach(x => println("-", x))
// vec.iter().forEach(x => println("-", x))
// vec.iter().map(x => x * 2).forEach(x => println("-", x))

vec.iter().map(x => x * 2).forEach(x => println("-", x))
